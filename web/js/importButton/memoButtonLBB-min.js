function MemoButtonToolkit(){this.evt="p",window.location.hostname.indexOf("beta")>=0?this.evt="r":window.location.hostname.indexOf("boomerang")>=0&&(this.evt="l"),this.init()}MemoButtonToolkit.prototype={init:function(t){this.clickedButtons=[],this.initCss(),this.initFrameMessageListener(),this.buildIframe(),this.buildButtons(),this.initEvents(),this.removeATags()},initCss:function(){var t,e=document.getElementsByTagName("link")[0];document.getElementById("memoCss")||((t=document.createElement("link")).id="memoCss",t.async=!0,t.type="text/css",t.rel="stylesheet","p"==this.evt?t.href="https://memo.pole-emploi.fr/css/importButton/memoButtonLBB.css":"r"==this.evt?t.href="https://memo.beta.pole-emploi.fr/css/importButton/memoButtonLBB.css":t.href="http://boomerang:8080/css/importButton/memoButtonLBB.css",e.parentNode.insertBefore(t,e))},initFrameMessageListener:function(){window.addEventListener("message",function(t){if((t.origin.indexOf("memo")>-1||t.origin.indexOf("boomerang")>-1)&&"setState"==t.data.type){var e=t.data.buttonId,o=$("#"+e);o.attr("data-original-title",t.data.btText),o.attr("class","btn-memo "+t.data.className),o.html("<div></div><span>"+t.data.btText+"</span><span class='sr-only'>"+t.data.srText+"</span>"),o.attr("title",t.data.btText),"btn-memo-off"==t.data.className?o.attr("disabled","disabled"):"btn-memo-on"==t.data.className&&memoButtonToolkit.clickedButtons.indexOf(e)>-1&&memoButtonToolkit.clickedButtons.splice(memoButtonToolkit.clickedButtons.indexOf(e),1)}})},buildButtons:function(){for(var t=document.getElementsByClassName("memo-import-button"),e=0,o=t.length;e<o;++e)this.buildButton(t[e],e)},buildIframe:function(){var t=document.createElement("iframe");t.setAttribute("title","Dispositif technique (aucun contenu)"),t.setAttribute("id","memo-iframe"),"p"==this.evt?t.setAttribute("src","https://memo.pole-emploi.fr/importButton/importButtonLBB.html"):"r"==this.evt?t.setAttribute("src","https://memo.beta.pole-emploi.fr/importButton/importButtonLBB.html"):t.setAttribute("src","http://boomerang:8080/importButton/importButtonLBB.html"),t.setAttribute("style","display:none; overflow:hidden; width:0px; height:0px;"),$("body").append(t)},buildButton:function(t,e){var o=document.createElement("button"),n="Enregistrer la fiche entreprise dans MEMO (Ouvre une fenÃªtre popup)";o.setAttribute("type","button"),o.setAttribute("id","memo-button-"+e),o.setAttribute("class","btn-memo btn-memo-on"),o.setAttribute("dataurl",t.getAttribute("data-url")),o.setAttribute("title",n),o.setAttribute("rel","nofollow"),t.parentNode.insertBefore(o,t.nextSibling),o.innerHTML="<div></div><span>Enregistrer dans MEMO</span><span class='sr-only'>"+n+"</span>",t.getAttribute("data-intro-js")&&0==e&&this.activateIntroJs()&&this.loadIntroJs()},initEvents:function(){for(var t=$("button.btn-memo"),e=0;e<t.length;++e)$(t[e]).on("click",function(t){memoButtonToolkit.sendClickOrder(t.currentTarget),localStorage.setItem("lastMemoClick",(new Date).getTime())});document.onkeydown=function(t){if(13===t.keyCode){var e=document.activeElement;e&&$(e).length>0&&$(e)[0].firstChild&&"btn-memo"==$(e)[0].firstChild.className&&memoButtonToolkit.sendClickOrder($(e)[0].firstChild)}}},sendClickOrder:function(t){var e=$("#"+t.id),o={id:"memo-iframe",type:"clickOrder",buttonId:t.id,url:e.attr("dataurl")};memoButtonToolkit.clickedButtons.indexOf(t.id)<0&&(memoButtonToolkit.postMessageToFrame(o),memoButtonToolkit.clickedButtons.push(t.id))},postMessageToFrame:function(t){try{window.frames[t.id].contentWindow.postMessage(t,"*")}catch(n){for(var e=$("#memo-iframe"),o=0;o<e.length;++o)window.MSInputMethodContext&&document.documentMode?window.frames[o].postMessage(t,"*"):window.frames[$("iframe").length>e.length?o+1:o].postMessage(t,"*")}},removeATags:function(){for(var t=document.getElementsByClassName("memo-import-button");t.length>0;)this.removeATag(t[0])},removeATag:function(t){t.parentNode.removeChild(t)},startIntroJs:function(){this.introJs=new introJs,this.introJs.setOptions({steps:[{element:"#memo-button-0",intro:"<b>Astuce : Utilisez le bouton MEMO</b><br /><br />Enregistrez toutes vos candidatures pour les suivre facilement depuis votre tableau de bord MEMO"}],doneLabel:"J'ai compris",showBullets:!1,showStepNumbers:!1,tooltipPosition:"top"}),this.introJs.start(),localStorage.setItem("lastMemoIntroJs",(new Date).getTime()),localStorage.setItem("memoIntroJsCount",localStorage.getItem("memoIntroJsCount")?2:1)},loadIntroJs:function(){try{introJs?this.startIntroJs():this.importIntroJs()}catch(t){this.importIntroJs()}},importIntroJs:function(){var t,e,o="https://memo.pole-emploi.fr/",n=document.getElementsByTagName("script")[0],i=document.getElementsByTagName("link")[0];(t=document.createElement("script")).async=!0,(e=document.createElement("link")).async=!0,window.location.hostname.indexOf("beta")>=0&&(o="https://memo.beta.pole-emploi.fr/"),t.src=o+"js/introjs/intro_memo-min.js",e.href=o+"css/introjs/introjs_memo-min.css",e.rel="stylesheet",e.type="text/css",n.parentNode.insertBefore(t,n),i.parentNode.insertBefore(e,i)},activateIntroJs:function(){var lMI=localStorage.getItem("lastMemoIntroJs"),mIC=localStorage.getItem("memoIntroJsCount")||0,lMC=localStorage.getItem("lastMemoClick"),now=(new Date).getTime(),res=!1;return mIC=eval(mIC),(!lMC||now-eval(lMC)>2592e6)&&(!lMI||now-eval(lMI)>12096e5)&&(!lMI||now-eval(lMI)>864e5&&mIC<2)&&(res=!0),res}},memoButtonToolkit=new MemoButtonToolkit;