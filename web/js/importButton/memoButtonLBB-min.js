function MemoButtonToolkit(){this.evt="p",window.location.hostname.indexOf("beta")>=0?this.evt="r":window.location.hostname.indexOf("boomerang")>=0&&(this.evt="l"),this.init()}MemoButtonToolkit.prototype={init:function(t){this.clickedButtons=[],this.initCss(),this.initFrameMessageListener(),this.buildIframe(),this.buildButtons(),this.initToolTip(),this.initEvents(),this.removeATags()},initCss:function(){var t,e=document.getElementsByTagName("link")[0];document.getElementById("memoCss")||((t=document.createElement("link")).id="memoCss",t.async=!0,t.type="text/css",t.rel="stylesheet","p"==this.evt?t.href="https://memo.pole-emploi.fr/css/importButton/memoButtonLBB.css":"r"==this.evt?t.href="https://memo.beta.pole-emploi.fr/css/importButton/memoButtonLBB.css":t.href="http://boomerang:8080/css/importButton/memoButtonLBB.css",e.parentNode.insertBefore(t,e))},initFrameMessageListener:function(){window.addEventListener("message",function(t){if((t.origin.indexOf("memo")>-1||t.origin.indexOf("boomerang")>-1)&&"setState"==t.data.type){var e=t.data.buttonId,o=$("#"+e);o.attr("data-original-title",t.data.btText),o.attr("class","btn-memo "+t.data.className),o.html("<div></div><span class='sr-only'>"+t.data.srText+"</span>"),$(".tooltip.in").html("<div class='tooltip-arrow' style='left: 50%;'></div><div class='tooltip-inner'>"+t.data.btText+"</div>"),o.attr("title",t.data.btText),"btn-memo-off"==t.data.className?o.attr("disabled","disabled"):"btn-memo-on"==t.data.className&&memoButtonToolkit.clickedButtons.indexOf(e)>-1&&memoButtonToolkit.clickedButtons.splice(memoButtonToolkit.clickedButtons.indexOf(e),1)}})},buildButtons:function(){for(var t=document.getElementsByClassName("memo-import-button"),e=0,o=t.length;e<o;++e)this.buildButton(t[e],e)},buildIframe:function(){var t=document.createElement("iframe");t.setAttribute("title","Dispositif technique (aucun contenu)"),t.setAttribute("id","memo-iframe"),"p"==this.evt?t.setAttribute("src","https://memo.pole-emploi.fr/importButton/importButtonLBB.html"):"r"==this.evt?t.setAttribute("src","https://memo.beta.pole-emploi.fr/importButton/importButtonLBB.html"):t.setAttribute("src","http://boomerang:8080/importButton/importButtonLBB.html"),t.setAttribute("style","display:none; overflow:hidden; width:0px; height:0px;"),$("body").append(t)},buildButton:function(t,e){var o=document.createElement("button"),n="Enregistrer la fiche entreprise dans MEMO (Ouvre une fenêtre popup)";o.setAttribute("type","button"),o.setAttribute("id","memo-button-"+e),o.setAttribute("class","btn-memo btn-memo-on"),o.setAttribute("dataurl",t.getAttribute("data-url")),o.setAttribute("title",n),o.setAttribute("rel","nofollow"),t.parentNode.insertBefore(o,t.nextSibling),o.innerHTML="<div></div><span class='sr-only'>"+n+"</span>"},initToolTip:function(){try{$("button.btn-memo").tooltip(),$("button.btn-memo").attr("title","Enregistrer l'offre d'emploi dans MEMO (Ouvre une fenêtre popup)")}catch(t){setTimeout(function(){memoButtonToolkit.initToolTip()},100)}},initEvents:function(){for(var t=$("button.btn-memo"),e=0;e<t.length;++e)$(t[e]).on("click",function(t){memoButtonToolkit.sendClickOrder(t.currentTarget),localStorage.setItem("lastMemoClick",(new Date).getTime()),memoButtonToolkit.clickedTooltipElement=t.currentTarget}),$(t[e]).on("focus",function(t){$(t.currentTarget).tooltip("show")}),$(t[e]).on("blur",function(t){$(t.currentTarget).tooltip("hide")}),$(t[e]).on("mouseout",function(t){memoButtonToolkit.clickedTooltipElement&&$(".tooltip").tooltip("hide")});document.onkeydown=function(t){if(13===t.keyCode){var e=document.activeElement;e&&$(e).length>0&&$(e)[0].firstChild&&"btn-memo"==$(e)[0].firstChild.className&&memoButtonToolkit.sendClickOrder($(e)[0].firstChild)}}},sendClickOrder:function(t){var e=$("#"+t.id),o={id:"memo-iframe",type:"clickOrder",buttonId:t.id,url:e.attr("dataurl")};memoButtonToolkit.clickedButtons.indexOf(t.id)<0&&(memoButtonToolkit.postMessageToFrame(o),memoButtonToolkit.clickedButtons.push(t.id))},postMessageToFrame:function(t){try{window.frames[t.id].contentWindow.postMessage(t,"*")}catch(n){for(var e=$("#memo-iframe"),o=0;o<e.length;++o)window.MSInputMethodContext&&document.documentMode?window.frames[o].postMessage(t,"*"):window.frames[$("iframe").length>e.length?o+1:o].postMessage(t,"*")}},removeATags:function(){for(var t=document.getElementsByClassName("memo-import-button");t.length>0;)this.removeATag(t[0])},removeATag:function(t){t.parentNode.removeChild(t)},startIntroJs:function(){}},memoButtonToolkit=new MemoButtonToolkit;