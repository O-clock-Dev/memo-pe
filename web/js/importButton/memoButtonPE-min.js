function MemoButtonToolkit(t){this.evt="p";var e=$("#ctj-script");e&&e.length>0?e.attr("src").indexOf("beta")>=0&&(this.evt="r"):window.location.hostname.indexOf("beta")>=0?this.evt="r":window.location.hostname.indexOf("boomerang")>=0&&(this.evt="l"),this.init(t)}MemoButtonToolkit.prototype={init:function(t,e){this.initCss(),this.initFrameMessageListener(),this.zipFilter=t,this.buildButtons(),this.initToolTip()},initCss:function(){var t,e=document.getElementsByTagName("link")[0];document.getElementById("memoCss")||((t=document.createElement("link")).id="memoCss",t.async=!0,t.type="text/css",t.rel="stylesheet","p"==this.evt?t.href="https://memo.pole-emploi.fr/css/importButton/memoButtonPE.css":"r"==this.evt?t.href="https://memo.beta.pole-emploi.fr/css/importButton/memoButtonPE.css":t.href="http://boomerang:8080/css/importButton/memoButtonPE.css",e.parentNode.insertBefore(t,e))},initFrameMessageListener:function(){window.addEventListener("message",function(t){if(t.origin.indexOf("memo")>-1||t.origin.indexOf("boomerang")>-1)if("setState"==t.data.type){var e=document.getElementById(t.data.id),o=document.getElementById(e.getAttribute("buttonId"));o.setAttribute("data-original-title",t.data.tooltip),o.setAttribute("class","btn-memo "+t.data.className),o.innerHTML="<span class='sr-only'>"+t.data.tooltip+"</span>",$(".tooltip.in").html("<div class='tooltip-arrow' style='left: 50%;'></div><div class='tooltip-inner'>"+t.data.tooltip+"</div>"),o.setAttribute("title",t.data.tooltip),"btn-memo-off"==t.data.className&&o.setAttribute("disabled","disabled")}else if("sendParameters"==t.data.type){e=$("#"+t.data.id);(n={}).id=e.attr("id"),n.size=e.attr("data-size"),n.url=e.attr("data-url"),n.idOffre=e.attr("data-id"),n.location=e.attr("data-location"),n.zipCode=e.attr("data-zipcode"),n.jobTitle=e.attr("data-title"),n.type="setAttributes",t.source.postMessage(n,"*")}else if("sendIdentity"==t.data.type)for(var i=$("iframe.btn-memo"),n={},s=0;s<i.length;++s)n.id=$(i[s]).attr("id"),n.link=t.data.link,n.type="identity",memoButtonToolkit.postMessageToFrame(n,s)})},buildButtons:function(){for(var t=document.getElementsByClassName("memo-import-button"),e=0,o=t.length;e<o;++e)this.buildButton(t[e],e)},buildButton:function(t,e){var o,i,n=t.getAttribute("data-location"),s=t.getAttribute("data-size"),r=t.getAttribute("data-zipcode");if(this.checkFilter(n,r)){if(o=document.createElement("iframe"),i=document.createElement("button"),o.setAttribute("title","Dispositif technique (aucun contenu)"),o.setAttribute("id","memo-iframe-"+e),o.setAttribute("buttonId","memo-button-"+e),i.setAttribute("type","button"),i.setAttribute("id","memo-button-"+e),i.setAttribute("frameId","memo-iframe-"+e),i.setAttribute("data-original-title","Enregistrer dans MEMO"),i.setAttribute("class","btn-memo btn-memo-on"),i.setAttribute("rel","nofollow"),"p"==this.evt?o.setAttribute("src","https://memo.pole-emploi.fr/importButton/importButtonPE.html"):"r"==this.evt?o.setAttribute("src","https://memo.beta.pole-emploi.fr/importButton/importButtonPE.html"):o.setAttribute("src","http://boomerang:8080/importButton/importButtonPE.html"),o.setAttribute("style","display:none; overflow:hidden; width:0px; height:0px;"),s&&"detail"==s?(i.setAttribute("style","overflow:hidden; width:21px; height:21px;"),o.setAttribute("data-size",s)):i.setAttribute("style","overflow:hidden; width:34px; height:34px;"),o.setAttribute("class","btn-memo"),o.setAttribute("data-url",t.getAttribute("data-url")),o.setAttribute("data-id",t.getAttribute("data-id-offre")),o.setAttribute("data-location",n),o.setAttribute("data-zipcode",r),o.setAttribute("data-title",t.getAttribute("data-title")),i.setAttribute("data-title",t.getAttribute("data-title")),t.parentNode.insertBefore(i,t.nextSibling),i.innerHTML="<span class='sr-only'>Enregistrer l'offre d'emploi dans MEMO (Ouvre une fenêtre popup)</span>",this.iFrameExists("memo-iframe-"+e)){var a={id:"memo-iframe-"+e,type:"getState"};this.postMessageToFrame(a)}else $("body").append(o);this.initEvents(i),this.removeATags()}},iFrameExists:function(t){var e=!1;return document.getElementById(t)&&(e=!0),e},initToolTip:function(){try{$("button.btn-memo").tooltip(),$("button.btn-memo").attr("title","Enregistrer l'offre d'emploi dans MEMO (Ouvre une fenêtre popup)")}catch(t){setTimeout(function(){memoButtonToolkit.initToolTip()},100)}},initEvents:function(t){for(var e=$(t),o=0;o<e.length;++o)$(e[o]).on("focus",function(t){$(t.currentTarget).tooltip("show")}),$(e[o]).on("blur",function(t){$(t.currentTarget).tooltip("hide")}),$(e[o]).on("mouseout",function(t){memoButtonToolkit.clickedTooltipElement&&$(".tooltip").tooltip("hide")}),$(e[o]).on("click",function(t){memoButtonToolkit.sendClickOrder(t.currentTarget),memoButtonToolkit.clickedTooltipElement=t.currentTarget});document.onkeydown=function(t){if(13===t.keyCode){var e=document.activeElement;e&&$(e).length>0&&$(e)[0].firstChild&&"btn-memo"==$(e)[0].firstChild.className&&memoButtonToolkit.sendClickOrder($(e)[0].firstChild)}}},sendClickOrder:function(t){var e={id:$(t).attr("frameId"),type:"keyboardClick"};this.postMessageToFrame(e)},postMessageToFrame:function(t,e){try{window.frames[t.id].contentWindow.postMessage(t,"*")}catch(n){if(e)window.MSInputMethodContext&&document.documentMode?window.frames[e].postMessage(t,"*"):window.frames[$("iframe").length>o.length?e+1:e].postMessage(t,"*");else for(var o=$("iframe.btn-memo"),i=0;i<o.length;++i)window.MSInputMethodContext&&document.documentMode?window.frames[i].postMessage(t,"*"):window.frames[$("iframe").length>o.length?i+1:i].postMessage(t,"*")}},removeATags:function(){for(var t=document.getElementsByClassName("memo-import-button");t.length>0;)this.removeATag(t[0])},removeATag:function(t){t.parentNode.removeChild(t)},checkFilter:function(location,zipCode){var res=0;if(this.zipFilter)try{var loc;if(location||zipCode)location&&(loc=location[0]+location[1],isNaN(loc)&&(loc="")),!loc&&zipCode&&(loc=zipCode[0]+zipCode[1],isNaN(loc)&&(loc="")),loc&&this.zipFilter.indexOf(eval(loc))>=0&&(res=1)}catch(t){console.log("filter err : ",t,this.zipFilter,location,zipCode)}else res=1;return res}},memoButtonToolkit=new MemoButtonToolkit;